env:
  gitconfigs: "ENCRYPTED[!e918d9400219b6f7d2588a0afd4fffd3df3735cf5db059e2733e4269c363811a818e686e7b04c2b4fd671580e393f20c!]"
  credensial: "ENCRYPTED[!6f130d1ac4acaf8c4a50f4ce8c5a9cefe2ad5e2fd511e0d25c3ca5d15f6f15977184c846ce5cee54bb6019a060648fed!]"
  tokentl: "ENCRYPTED[!48df36a023301be77fca5928aee9d9aa41d168a17b49a1379dcdd2544d897abdd71244a71b29f810411fefc8404625d2!]"
  idtl: "ENCRYPTED[!a12665bdcb530d0f6222ec4f353356c9819303c6a85209c78bd9c1f2d57b16912c9b96d60e567367846f2438f9f75967!]"
  tokenpat: "ENCRYPTED[!55a825eae5c6b48595000403feb93a1e434b2f6de64ff689cfc8df0079370cfd777f7a3f304e78ec524fd06e2d3e3ac5!]"

task:
  name: "RBE ROM"
  timeout_in: 120m
  container:
    image: ghcr.io/rovars/docker:ubuntu
    cpu: 8
    memory: 32G
    greedy: true

  sync_script:
    - echo "$credensial" > ~/.git-credentials
    - echo "$gitconfigs" > ~/.gitconfig
    - ./main.sh sync
  build_script: ./main.sh build
  upload_script: ./main.sh upload
  rbe_logs_script: cat /tmp/rbe_metrics.txt

  on_failure:
    notiferror_script:
      - export SRC_DIR=$PWD/src
      - xc -x "Build Failed!"
      - xc -c "$SRC_DIR/out/error.log"
      - cat "$SRC_DIR/out/error.log"